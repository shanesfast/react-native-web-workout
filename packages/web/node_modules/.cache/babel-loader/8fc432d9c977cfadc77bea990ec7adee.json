{"ast":null,"code":"var Class = require('../../core/class');\n\nvar Container = require('../../dom/container');\n\nvar Element = require('../../dom/native');\n\nvar fps = 1000 / 60,\n    invalids = [],\n    renderTimer,\n    renderInvalids = function () {\n  clearTimeout(renderTimer);\n  renderTimer = null;\n  var canvases = invalids;\n  invalids = [];\n\n  for (var i = 0, l = canvases.length; i < l; i++) {\n    var c = canvases[i];\n    c._valid = true;\n    c.render();\n  }\n};\n\nvar resolution = typeof window !== 'undefined' && window.devicePixelRatio || 1;\nvar previousHit = null,\n    previousHitSurface = null;\nvar CanvasSurface = Class(Element, Container, {\n  initialize: function (width, height, existingElement) {\n    var element = this.element = existingElement || document.createElement('canvas');\n    var context = this.context = element.getContext('2d');\n    this._valid = true;\n    if (width != null && height != null) this.resize(width, height);\n    element.addEventListener('mousemove', this, false);\n    element.addEventListener('mouseout', this, false);\n    element.addEventListener('mouseover', this, false);\n    element.addEventListener('mouseup', this, false);\n    element.addEventListener('mousedown', this, false);\n    element.addEventListener('click', this, false);\n  },\n  handleEvent: function (event) {\n    if (event.clientX == null) return;\n    var element = this.element,\n        rect = element.getBoundingClientRect(),\n        x = event.clientX - rect.left - element.clientLeft,\n        y = event.clientY - rect.top - element.clientTop,\n        hit = this.hitTest(x, y);\n\n    if (hit !== previousHit) {\n      if (previousHit) {\n        previousHit.dispatch({\n          type: 'mouseout',\n          target: previousHit,\n          relatedTarget: hit,\n          sourceEvent: event\n        });\n      }\n\n      if (hit) {\n        hit.dispatch({\n          type: 'mouseover',\n          target: hit,\n          relatedTarget: previousHit,\n          sourceEvent: event\n        });\n      }\n\n      previousHit = hit;\n      previousHitSurface = this;\n      this.refreshCursor();\n    }\n\n    if (hit) hit.dispatch(event);\n  },\n  refreshCursor: function () {\n    if (previousHitSurface !== this) return;\n    var hit = previousHit,\n        hitCursor = '',\n        hitTooltip = '';\n\n    while (hit) {\n      if (!hitCursor && hit._cursor) {\n        hitCursor = hit._cursor;\n        if (hitTooltip) break;\n      }\n\n      if (!hitTooltip && hit._tooltip) {\n        hitTooltip = hit._tooltip;\n        if (hitCursor) break;\n      }\n\n      hit = hit.parentNode;\n    } // TODO: No way to set cursor/title on the surface\n\n\n    this.element.style.cursor = hitCursor;\n    this.element.title = hitTooltip;\n  },\n  resize: function (width, height) {\n    var element = this.element;\n    element.setAttribute('width', width * resolution);\n    element.setAttribute('height', height * resolution);\n    element.style.width = width + 'px';\n    element.style.height = height + 'px';\n    this.width = width;\n    this.height = height;\n    return this;\n  },\n  invalidate: function (left, top, width, height) {\n    if (this._valid) {\n      this._valid = false;\n      invalids.push(this);\n\n      if (!renderTimer) {\n        if (window.mozRequestAnimationFrame) {\n          renderTimer = true;\n          window.mozRequestAnimationFrame(renderInvalids);\n        } else {\n          renderTimer = setTimeout(renderInvalids, fps);\n        }\n      }\n    }\n\n    return this;\n  },\n  hitTest: function (x, y) {\n    if (x < 0 || y < 0 || x > this.width || y > this.height) return null;\n    var node = this.lastChild;\n\n    while (node) {\n      var hit = node.hitTest(x, y);\n      if (hit) return hit;\n      node = node.previousSibling;\n    }\n\n    return null;\n  },\n  render: function () {\n    var node = this.firstChild,\n        context = this.context;\n    context.setTransform(resolution, 0, 0, resolution, 0, 0);\n    context.clearRect(0, 0, this.width, this.height);\n\n    while (node) {\n      node.renderTo(context, resolution, 0, 0, resolution, 0, 0);\n      node = node.nextSibling;\n    }\n\n    this.refreshCursor();\n  }\n});\nCanvasSurface.tagName = 'canvas';\nmodule.exports = CanvasSurface;","map":{"version":3,"sources":["/Users/quickmac/Desktop/node_projects/react-native-web-workout/node_modules/art/modes/canvas/surface.js"],"names":["Class","require","Container","Element","fps","invalids","renderTimer","renderInvalids","clearTimeout","canvases","i","l","length","c","_valid","render","resolution","window","devicePixelRatio","previousHit","previousHitSurface","CanvasSurface","initialize","width","height","existingElement","element","document","createElement","context","getContext","resize","addEventListener","handleEvent","event","clientX","rect","getBoundingClientRect","x","left","clientLeft","y","clientY","top","clientTop","hit","hitTest","dispatch","type","target","relatedTarget","sourceEvent","refreshCursor","hitCursor","hitTooltip","_cursor","_tooltip","parentNode","style","cursor","title","setAttribute","invalidate","push","mozRequestAnimationFrame","setTimeout","node","lastChild","previousSibling","firstChild","setTransform","clearRect","renderTo","nextSibling","tagName","module","exports"],"mappings":"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","sourcesContent":["var Class = require('../../core/class');\nvar Container = require('../../dom/container');\nvar Element = require('../../dom/native');\n\nvar fps = 1000 / 60, invalids = [], renderTimer, renderInvalids = function(){\n\tclearTimeout(renderTimer);\n\trenderTimer = null;\n\tvar canvases = invalids;\n\tinvalids = [];\n\tfor (var i = 0, l = canvases.length; i < l; i++){\n\t\tvar c = canvases[i];\n\t\tc._valid = true;\n\t\tc.render();\n\t}\n};\n\nvar resolution = typeof window !== 'undefined' && window.devicePixelRatio || 1;\n\nvar previousHit = null, previousHitSurface = null;\n\nvar CanvasSurface = Class(Element, Container, {\n\n\tinitialize: function(width, height, existingElement){\n\t\tvar element = this.element = existingElement || document.createElement('canvas');\n\t\tvar context = this.context = element.getContext('2d');\n\t\tthis._valid = true;\n\t\tif (width != null && height != null) this.resize(width, height);\n\n\t\telement.addEventListener('mousemove', this, false);\n\t\telement.addEventListener('mouseout', this, false);\n\t\telement.addEventListener('mouseover', this, false);\n\t\telement.addEventListener('mouseup', this, false);\n\t\telement.addEventListener('mousedown', this, false);\n\t\telement.addEventListener('click', this, false);\n\t},\n\n\thandleEvent: function(event){\n\t\tif (event.clientX == null) return;\n\t\tvar element = this.element,\n\t\t\trect = element.getBoundingClientRect(),\n\t\t\tx = event.clientX - rect.left - element.clientLeft,\n\t\t\ty = event.clientY - rect.top - element.clientTop,\n\t\t\thit = this.hitTest(x, y);\n\n\t\tif (hit !== previousHit){\n\t\t\tif (previousHit){\n\t\t\t\tpreviousHit.dispatch({\n\t\t\t\t\ttype: 'mouseout',\n\t\t\t\t\ttarget: previousHit,\n\t\t\t\t\trelatedTarget: hit,\n\t\t\t\t\tsourceEvent: event\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (hit){\n\t\t\t\thit.dispatch({\n\t\t\t\t\ttype: 'mouseover',\n\t\t\t\t\ttarget: hit,\n\t\t\t\t\trelatedTarget: previousHit,\n\t\t\t\t\tsourceEvent: event\n\t\t\t\t});\n\t\t\t}\n\t\t\tpreviousHit = hit;\n\t\t\tpreviousHitSurface = this;\n\t\t\tthis.refreshCursor();\n\t\t}\n\n\t\tif (hit) hit.dispatch(event);\n\t},\n\n\trefreshCursor: function(){\n\t\tif (previousHitSurface !== this) return;\n\t\tvar hit = previousHit, hitCursor = '', hitTooltip = '';\n\t\twhile (hit){\n\t\t\tif (!hitCursor && hit._cursor){\n\t\t\t\thitCursor = hit._cursor;\n\t\t\t\tif (hitTooltip) break;\n\t\t\t}\n\t\t\tif (!hitTooltip && hit._tooltip){\n\t\t\t\thitTooltip = hit._tooltip;\n\t\t\t\tif (hitCursor) break;\n\t\t\t}\n\t\t\thit = hit.parentNode;\n\t\t}\n\t\t// TODO: No way to set cursor/title on the surface\n\t\tthis.element.style.cursor = hitCursor;\n\t\tthis.element.title = hitTooltip;\n\t},\n\n\tresize: function(width, height){\n\t\tvar element = this.element;\n\t\telement.setAttribute('width', width * resolution);\n\t\telement.setAttribute('height', height * resolution);\n\t\telement.style.width = width + 'px';\n\t\telement.style.height = height + 'px';\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\treturn this;\n\t},\n\n\tinvalidate: function(left, top, width, height){\n\t\tif (this._valid){\n\t\t\tthis._valid = false;\n\t\t\tinvalids.push(this);\n\t\t\tif (!renderTimer){\n\t\t\t\tif (window.mozRequestAnimationFrame){\n\t\t\t\t\trenderTimer = true;\n\t\t\t\t\twindow.mozRequestAnimationFrame(renderInvalids);\n\t\t\t\t} else {\n\t\t\t\t\trenderTimer = setTimeout(renderInvalids, fps);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\n\thitTest: function(x, y){\n\t\tif (x < 0 || y < 0 || x > this.width || y > this.height) return null;\n\t\tvar node = this.lastChild;\n\t\twhile (node){\n\t\t\tvar hit = node.hitTest(x, y);\n\t\t\tif (hit) return hit;\n\t\t\tnode = node.previousSibling;\n\t\t}\n\t\treturn null;\n\t},\n\n\trender: function(){\n\t\tvar node = this.firstChild, context = this.context;\n\t\tcontext.setTransform(resolution, 0, 0, resolution, 0, 0);\n\t\tcontext.clearRect(0, 0, this.width, this.height);\n\t\twhile (node){\n\t\t\tnode.renderTo(context, resolution, 0, 0, resolution, 0, 0);\n\t\t\tnode = node.nextSibling;\n\t\t}\n\t\tthis.refreshCursor();\n\t}\n\n});\n\nCanvasSurface.tagName = 'canvas';\n\nmodule.exports = CanvasSurface;"]},"metadata":{},"sourceType":"script"}