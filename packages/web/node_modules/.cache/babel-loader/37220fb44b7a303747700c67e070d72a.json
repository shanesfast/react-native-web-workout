{"ast":null,"code":"var Class = require('../../core/class');\n\nvar Transform = require('../../core/transform');\n\nvar Element = require('../../dom/dummy');\n\nvar CanvasNode = Class(Transform, Element, {\n  invalidate: function () {\n    if (this.parentNode) this.parentNode.invalidate();\n    if (this._layer) this._layerCache = null;\n    return this;\n  },\n  _place: function () {\n    this.invalidate();\n  },\n  _transform: function () {\n    this.invalidate();\n  },\n  blend: function (opacity) {\n    if (opacity >= 1 && this._layer) this._layer = null;\n    this._opacity = opacity;\n    if (this.parentNode) this.parentNode.invalidate();\n    return this;\n  },\n  // visibility\n  hide: function () {\n    this._invisible = true;\n    if (this.parentNode) this.parentNode.invalidate();\n    return this;\n  },\n  show: function () {\n    this._invisible = false;\n    if (this.parentNode) this.parentNode.invalidate();\n    return this;\n  },\n  // interaction\n  indicate: function (cursor, tooltip) {\n    this._cursor = cursor;\n    this._tooltip = tooltip;\n    return this.invalidate();\n  },\n  hitTest: function (x, y) {\n    if (this._invisible) return null;\n    var point = this.inversePoint(x, y);\n    if (!point) return null;\n    return this.localHitTest(point.x, point.y);\n  },\n  // rendering\n  renderTo: function (context, xx, yx, xy, yy, x, y) {\n    var opacity = this._opacity;\n\n    if (opacity == null || opacity >= 1) {\n      return this.renderLayerTo(context, xx, yx, xy, yy, x, y);\n    } // Render to a compositing layer and cache it\n\n\n    var layer = this._layer,\n        canvas,\n        isDirty = true,\n        w = context.canvas.width,\n        h = context.canvas.height;\n\n    if (layer) {\n      layer.setTransform(1, 0, 0, 1, 0, 0);\n      canvas = layer.canvas;\n\n      if (canvas.width < w || canvas.height < h) {\n        canvas.width = w;\n        canvas.height = h;\n      } else {\n        var c = this._layerCache;\n\n        if (c && c.xx === xx && c.yx === yx && c.xy === xy && c.yy === yy && c.x === x && c.y === y) {\n          isDirty = false;\n        } else {\n          layer.clearRect(0, 0, w, h);\n        }\n      }\n    } else {\n      canvas = document.createElement('canvas');\n      canvas.width = w;\n      canvas.height = h;\n      this._layer = layer = canvas.getContext('2d');\n    }\n\n    if (isDirty) {\n      this.renderLayerTo(layer, xx, yx, xy, yy, x, y);\n      this._layerCache = {\n        xx: xx,\n        yx: yx,\n        xy: xy,\n        yy: yy,\n        x: x,\n        y: y\n      };\n    }\n\n    context.globalAlpha = opacity;\n    context.setTransform(1, 0, 0, 1, 0, 0);\n    context.drawImage(canvas, 0, 0, w, h, 0, 0, w, h);\n    context.globalAlpha = 1;\n  }\n});\nmodule.exports = CanvasNode;","map":{"version":3,"sources":["/Users/quickmac/Desktop/node_projects/react-native-web-workout/node_modules/art/modes/canvas/node.js"],"names":["Class","require","Transform","Element","CanvasNode","invalidate","parentNode","_layer","_layerCache","_place","_transform","blend","opacity","_opacity","hide","_invisible","show","indicate","cursor","tooltip","_cursor","_tooltip","hitTest","x","y","point","inversePoint","localHitTest","renderTo","context","xx","yx","xy","yy","renderLayerTo","layer","canvas","isDirty","w","width","h","height","setTransform","c","clearRect","document","createElement","getContext","globalAlpha","drawImage","module","exports"],"mappings":"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","sourcesContent":["var Class = require('../../core/class');\nvar Transform = require('../../core/transform');\nvar Element = require('../../dom/dummy');\n\nvar CanvasNode = Class(Transform, Element, {\n\t\n\tinvalidate: function(){\n\t\tif (this.parentNode) this.parentNode.invalidate();\n\t\tif (this._layer) this._layerCache = null;\n\t\treturn this;\n\t},\n\n\t_place: function(){\n\t\tthis.invalidate();\n\t},\n\t\n\t_transform: function(){\n\t\tthis.invalidate();\n\t},\n\t\n\tblend: function(opacity){\n\t\tif (opacity >= 1 && this._layer) this._layer = null;\n\t\tthis._opacity = opacity;\n\t\tif (this.parentNode) this.parentNode.invalidate();\n\t\treturn this;\n\t},\n\t\n\t// visibility\n\t\n\thide: function(){\n\t\tthis._invisible = true;\n\t\tif (this.parentNode) this.parentNode.invalidate();\n\t\treturn this;\n\t},\n\t\n\tshow: function(){\n\t\tthis._invisible = false;\n\t\tif (this.parentNode) this.parentNode.invalidate();\n\t\treturn this;\n\t},\n\t\n\t// interaction\n\t\n\tindicate: function(cursor, tooltip){\n\t\tthis._cursor = cursor;\n\t\tthis._tooltip = tooltip;\n\t\treturn this.invalidate();\n\t},\n\n\thitTest: function(x, y){\n\t\tif (this._invisible) return null;\n\t\tvar point = this.inversePoint(x, y);\n\t\tif (!point) return null;\n\t\treturn this.localHitTest(point.x, point.y);\n\t},\n\n\t// rendering\n\n\trenderTo: function(context, xx, yx, xy, yy, x, y){\n\t\tvar opacity = this._opacity;\n\t\tif (opacity == null || opacity >= 1){\n\t\t\treturn this.renderLayerTo(context, xx, yx, xy, yy, x, y);\n\t\t}\n\n\t\t// Render to a compositing layer and cache it\n\n\t\tvar layer = this._layer, canvas, isDirty = true,\n\t\t\tw = context.canvas.width, h = context.canvas.height;\n\t\tif (layer){\n\t\t\tlayer.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\tcanvas = layer.canvas;\n\t\t\tif (canvas.width < w || canvas.height < h){\n\t\t\t\tcanvas.width = w;\n\t\t\t\tcanvas.height = h;\n\t\t\t} else {\n\t\t\t\tvar c = this._layerCache;\n\t\t\t\tif (c && c.xx === xx && c.yx === yx && c.xy === xy\n\t\t\t\t\t&& c.yy === yy && c.x === x && c.y === y){\n\t\t\t\t\tisDirty = false;\n\t\t\t\t} else {\n\t\t\t\t\tlayer.clearRect(0, 0, w, h);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tcanvas = document.createElement('canvas');\n\t\t\tcanvas.width = w;\n\t\t\tcanvas.height = h;\n\t\t\tthis._layer = layer = canvas.getContext('2d');\n\t\t}\n\n\t\tif (isDirty){\n\t\t\tthis.renderLayerTo(layer, xx, yx, xy, yy, x, y);\n\t\t\tthis._layerCache = {\n\t\t\t\txx: xx,\n\t\t\t\tyx: yx,\n\t\t\t\txy: xy,\n\t\t\t\tyy: yy,\n\t\t\t\tx: x,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tcontext.globalAlpha = opacity;\n\t\tcontext.setTransform(1, 0, 0, 1, 0, 0);\n\t\tcontext.drawImage(\n\t\t\tcanvas,\n\t\t\t0, 0, w, h,\n\t\t\t0, 0, w, h\n\t\t);\n\t\tcontext.globalAlpha = 1;\n\t}\n\n});\n\nmodule.exports = CanvasNode;"]},"metadata":{},"sourceType":"script"}