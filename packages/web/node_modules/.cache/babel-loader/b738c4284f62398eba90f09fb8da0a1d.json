{"ast":null,"code":"var Class = require('../../core/class');\n\nvar Color = require('../../core/color');\n\nvar Transform = require('../../core/transform');\n\nvar Node = require('./node');\n\nvar genericCanvas = typeof document !== 'undefined' && document.createElement('canvas'),\n    genericContext = genericCanvas && genericCanvas.getContext && genericCanvas.getContext('2d');\n\nfunction recolorImage(img, color1, color2) {\n  // TODO: Fix this experimental implementation\n  color1 = Color.detach(color1);\n  color2 = Color.detach(color2);\n  var canvas = document.createElement('canvas'),\n      context = canvas.getContext('2d');\n  canvas.width = img.width;\n  canvas.height = img.height;\n  context.fillStyle = color2[0];\n  context.fillRect(0, 0, img.width, img.height);\n  context.globalCompositeOperation = 'lighter';\n  context.drawImage(img, 0, 0);\n  return canvas;\n}\n\nvar Base = Class(Node, {\n  initialize: function () {\n    this._fill = null;\n    this._pendingFill = null;\n    this._fillTransform = null;\n    this._stroke = null;\n    this._strokeCap = null;\n    this._strokeDash = null;\n    this._strokeJoin = null;\n    this._strokeWidth = null;\n  },\n\n  /* styles */\n  _addColors: function (gradient, stops) {\n    // Enumerate stops, assumes offsets are enumerated in order\n    // TODO: Sort. Chrome doesn't always enumerate in expected order but requires stops to be specified in order.\n    if ('length' in stops) for (var i = 0, l = stops.length - 1; i <= l; i++) gradient.addColorStop(i / l, new Color(stops[i]).toString());else for (var offset in stops) gradient.addColorStop(offset, new Color(stops[offset]).toString());\n    return gradient;\n  },\n  fill: function (color) {\n    if (arguments.length > 1) return this.fillLinear(arguments);\n    if (this._pendingFill) this._pendingFill();\n    this._fill = color ? new Color(color).toString() : null;\n    return this.invalidate();\n  },\n  fillRadial: function (stops, focusX, focusY, radiusX, radiusY, centerX, centerY) {\n    if (focusX == null) focusX = (this.left || 0) + (this.width || 0) * 0.5;\n    if (focusY == null) focusY = (this.top || 0) + (this.height || 0) * 0.5;\n    if (radiusY == null) radiusY = radiusX || this.height * 0.5 || 0;\n    if (radiusX == null) radiusX = (this.width || 0) * 0.5;\n    if (centerX == null) centerX = focusX;\n    if (centerY == null) centerY = focusY;\n    centerX += centerX - focusX;\n    centerY += centerY - focusY;\n    if (radiusX === 0 || radiusX === '0') return this.fillLinear(stops);\n    var ys = radiusY / radiusX;\n    if (this._pendingFill) this._pendingFill();\n    var gradient = genericContext.createRadialGradient(focusX, focusY / ys, 0, centerX, centerY / ys, radiusX * 2); // Double fill radius to simulate repeating gradient\n\n    if ('length' in stops) for (var i = 0, l = stops.length - 1; i <= l; i++) {\n      gradient.addColorStop(i / l / 2, new Color(stops[i]).toString());\n      gradient.addColorStop(1 - i / l / 2, new Color(stops[i]).toString());\n    } else for (var offset in stops) {\n      gradient.addColorStop(offset / 2, new Color(stops[offset]).toString());\n      gradient.addColorStop(1 - offset / 2, new Color(stops[offset]).toString());\n    }\n    this._fill = gradient;\n    this._fillTransform = new Transform(1, 0, 0, ys);\n    return this.invalidate();\n  },\n  fillLinear: function (stops, x1, y1, x2, y2) {\n    if (arguments.length < 5) {\n      var angle = (x1 == null ? 270 : x1) * Math.PI / 180;\n      var x = Math.cos(angle),\n          y = -Math.sin(angle),\n          l = (Math.abs(x) + Math.abs(y)) / 2,\n          w = this.width || 1,\n          h = this.height || 1;\n      x *= l;\n      y *= l;\n      x1 = 0.5 - x;\n      x2 = 0.5 + x;\n      y1 = 0.5 - y;\n      y2 = 0.5 + y;\n      this._fillTransform = new Transform(w, 0, 0, h);\n    } else {\n      this._fillTransform = null;\n    }\n\n    if (this._pendingFill) this._pendingFill();\n    var gradient = genericContext.createLinearGradient(x1, y1, x2, y2);\n\n    this._addColors(gradient, stops);\n\n    this._fill = gradient;\n    return this.invalidate();\n  },\n  fillImage: function (url, width, height, left, top, color1, color2) {\n    if (this._pendingFill) this._pendingFill();\n    var img = url;\n\n    if (!(img instanceof Image)) {\n      img = new Image();\n      img.src = url;\n    }\n\n    if (img.width && img.height) {\n      return this._fillImage(img, width, height, left || 0, top || 0, color1, color2);\n    } // Not yet loaded\n\n\n    this._fill = null;\n\n    var self = this,\n        callback = function () {\n      cancel();\n\n      self._fillImage(img, width, height, left || 0, top || 0, color1, color2);\n    },\n        cancel = function () {\n      img.removeEventListener('load', callback, false);\n      self._pendingFill = null;\n    };\n\n    this._pendingFill = cancel;\n    img.addEventListener('load', callback, false);\n    return this;\n  },\n  _fillImage: function (img, width, height, left, top, color1, color2) {\n    var w = width ? width / img.width : 1,\n        h = height ? height / img.height : 1;\n    if (color1 != null) img = recolorImage(img, color1, color2);\n    this._fill = genericContext.createPattern(img, 'repeat');\n    this._fillTransform = new Transform(w, 0, 0, h, left || 0, top || 0);\n    return this.invalidate();\n  },\n  stroke: function (color, width, cap, join, dash) {\n    this._stroke = color ? new Color(color).toString() : null;\n    this._strokeWidth = width != null ? width : 1;\n    this._strokeCap = cap != null ? cap : 'round';\n    this._strokeJoin = join != null ? join : 'round';\n    this._strokeDash = dash;\n    return this.invalidate();\n  },\n  // Rendering\n  element_renderTo: Node.prototype.renderTo,\n  renderTo: function (context, xx, yx, xy, yy, x, y) {\n    var opacity = this._opacity;\n\n    if (opacity == null || opacity >= 1) {\n      return this.renderLayerTo(context, xx, yx, xy, yy, x, y);\n    }\n\n    if (this._fill && this._stroke) {\n      return this.element_renderTo(context, xx, yx, xy, yy, x, y);\n    }\n\n    context.globalAlpha = opacity;\n    var r = this.renderLayerTo(context, xx, yx, xy, yy, x, y);\n    context.globalAlpha = 1;\n    return r;\n  },\n  renderLayerTo: function (context, xx, yx, xy, yy, x, y) {\n    context.setTransform(xx, yx, xy, yy, x, y);\n    this.renderShapeTo(context);\n  }\n});\nBase._genericContext = genericContext;\nmodule.exports = Base;","map":{"version":3,"sources":["/Users/quickmac/Desktop/node_projects/react-native-web-workout/node_modules/art/modes/canvas/base.js"],"names":["Class","require","Color","Transform","Node","genericCanvas","document","createElement","genericContext","getContext","recolorImage","img","color1","color2","detach","canvas","context","width","height","fillStyle","fillRect","globalCompositeOperation","drawImage","Base","initialize","_fill","_pendingFill","_fillTransform","_stroke","_strokeCap","_strokeDash","_strokeJoin","_strokeWidth","_addColors","gradient","stops","i","l","length","addColorStop","toString","offset","fill","color","arguments","fillLinear","invalidate","fillRadial","focusX","focusY","radiusX","radiusY","centerX","centerY","left","top","ys","createRadialGradient","x1","y1","x2","y2","angle","Math","PI","x","cos","y","sin","abs","w","h","createLinearGradient","fillImage","url","Image","src","_fillImage","self","callback","cancel","removeEventListener","addEventListener","createPattern","stroke","cap","join","dash","element_renderTo","prototype","renderTo","xx","yx","xy","yy","opacity","_opacity","renderLayerTo","globalAlpha","r","setTransform","renderShapeTo","_genericContext","module","exports"],"mappings":"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","sourcesContent":["var Class = require('../../core/class');\nvar Color = require('../../core/color');\nvar Transform = require('../../core/transform');\nvar Node = require('./node');\n\nvar genericCanvas = typeof document !== 'undefined' && document.createElement('canvas'),\n    genericContext = genericCanvas && genericCanvas.getContext && genericCanvas.getContext('2d');\n\nfunction recolorImage(img, color1, color2){\n\t// TODO: Fix this experimental implementation\n\tcolor1 = Color.detach(color1);\n\tcolor2 = Color.detach(color2);\n\tvar canvas = document.createElement('canvas'),\n\t\tcontext = canvas.getContext('2d');\n\tcanvas.width = img.width;\n\tcanvas.height = img.height;\n\tcontext.fillStyle = color2[0];\n\tcontext.fillRect(0, 0, img.width, img.height);\n\tcontext.globalCompositeOperation = 'lighter';\n\tcontext.drawImage(img, 0, 0);\n\treturn canvas;\n}\n\nvar Base = Class(Node, {\n\n\tinitialize: function(){\n\t\tthis._fill = null;\n\t\tthis._pendingFill = null;\n\t\tthis._fillTransform = null;\n\t\tthis._stroke = null;\n\t\tthis._strokeCap = null;\n\t\tthis._strokeDash = null;\n\t\tthis._strokeJoin = null;\n\t\tthis._strokeWidth = null;\n\t},\n\n\t/* styles */\n\n\t_addColors: function(gradient, stops){\n\t\t// Enumerate stops, assumes offsets are enumerated in order\n\t\t// TODO: Sort. Chrome doesn't always enumerate in expected order but requires stops to be specified in order.\n\t\tif ('length' in stops) for (var i = 0, l = stops.length - 1; i <= l; i++)\n\t\t\tgradient.addColorStop(i / l, new Color(stops[i]).toString());\n\t\telse for (var offset in stops)\n\t\t\tgradient.addColorStop(offset, new Color(stops[offset]).toString());\n\t\treturn gradient;\n\t},\n\n\n\tfill: function(color){\n\t\tif (arguments.length > 1) return this.fillLinear(arguments);\n\t\tif (this._pendingFill) this._pendingFill();\n\t\tthis._fill = color ? new Color(color).toString() : null;\n\t\treturn this.invalidate();\n\t},\n\n\tfillRadial: function(stops, focusX, focusY, radiusX, radiusY, centerX, centerY){\n\t\tif (focusX == null) focusX = (this.left || 0) + (this.width || 0) * 0.5;\n\t\tif (focusY == null) focusY = (this.top || 0) + (this.height || 0) * 0.5;\n\t\tif (radiusY == null) radiusY = radiusX || (this.height * 0.5) || 0;\n\t\tif (radiusX == null) radiusX = (this.width || 0) * 0.5;\n\t\tif (centerX == null) centerX = focusX;\n\t\tif (centerY == null) centerY = focusY;\n\n\t\tcenterX += centerX - focusX;\n\t\tcenterY += centerY - focusY;\n\n\t\tif (radiusX === 0 || radiusX === '0') return this.fillLinear(stops);\n\t\tvar ys = radiusY / radiusX;\n\n\t\tif (this._pendingFill) this._pendingFill();\n\n\t\tvar gradient = genericContext.createRadialGradient(focusX, focusY / ys, 0, centerX, centerY / ys, radiusX * 2);\n\n\t\t// Double fill radius to simulate repeating gradient\n\t\tif ('length' in stops) for (var i = 0, l = stops.length - 1; i <= l; i++){\n\t\t\tgradient.addColorStop(i / l / 2, new Color(stops[i]).toString());\n\t\t\tgradient.addColorStop(1 - i / l / 2, new Color(stops[i]).toString());\n\t\t} else for (var offset in stops){\n\t\t\tgradient.addColorStop(offset / 2, new Color(stops[offset]).toString());\n\t\t\tgradient.addColorStop(1- offset / 2, new Color(stops[offset]).toString());\n\t\t}\n\n\t\tthis._fill = gradient;\n\t\tthis._fillTransform = new Transform(1, 0, 0, ys);\n\t\treturn this.invalidate();\n\t},\n\n\tfillLinear: function(stops, x1, y1, x2, y2){\n\t\tif (arguments.length < 5){\n\t\t\tvar angle = ((x1 == null) ? 270 : x1) * Math.PI / 180;\n\n\t\t\tvar x = Math.cos(angle), y = -Math.sin(angle),\n\t\t\t\tl = (Math.abs(x) + Math.abs(y)) / 2,\n\t\t\t\tw = this.width || 1, h = this.height || 1;\n\n\t\t\tx *= l; y *= l;\n\n\t\t\tx1 = 0.5 - x;\n\t\t\tx2 = 0.5 + x;\n\t\t\ty1 = 0.5 - y;\n\t\t\ty2 = 0.5 + y;\n\t\t\tthis._fillTransform = new Transform(w, 0, 0, h);\n\t\t} else {\n\t\t\tthis._fillTransform = null;\n\t\t}\n\t\tif (this._pendingFill) this._pendingFill();\n\t\tvar gradient = genericContext.createLinearGradient(x1, y1, x2, y2);\n\t\tthis._addColors(gradient, stops);\n\t\tthis._fill = gradient;\n\t\treturn this.invalidate();\n\t},\n\n\tfillImage: function(url, width, height, left, top, color1, color2){\n\t\tif (this._pendingFill) this._pendingFill();\n\t\tvar img = url;\n\t\tif (!(img instanceof Image)){\n\t\t\timg = new Image();\n\t\t\timg.src = url;\n\t\t}\n\t\tif (img.width && img.height){\n\t\t\treturn this._fillImage(img, width, height, left || 0, top || 0, color1, color2);\n\t\t}\n\n\t\t// Not yet loaded\n\t\tthis._fill = null;\n\t\tvar self = this,\n\t\t\tcallback = function(){\n\t\t\t\tcancel();\n\t\t\t\tself._fillImage(img, width, height, left || 0, top || 0, color1, color2);\n\t\t\t},\n\t\t\tcancel = function(){\n\t\t\t\timg.removeEventListener('load', callback, false);\n\t\t\t\tself._pendingFill = null;\n\t\t\t};\n\t\tthis._pendingFill = cancel;\n\t\timg.addEventListener('load', callback, false);\n\t\treturn this;\n\t},\n\n\t_fillImage: function(img, width, height, left, top, color1, color2){\n\t\tvar w = width ? width / img.width : 1,\n\t\t\th = height ? height / img.height : 1;\n\t\tif (color1 != null) img = recolorImage(img, color1, color2);\n\t\tthis._fill = genericContext.createPattern(img, 'repeat');\n\t\tthis._fillTransform = new Transform(w, 0, 0, h, left || 0, top || 0);\n\t\treturn this.invalidate();\n\t},\n\n\tstroke: function(color, width, cap, join, dash){\n\t\tthis._stroke = color ? new Color(color).toString() : null;\n\t\tthis._strokeWidth = (width != null) ? width : 1;\n\t\tthis._strokeCap = (cap != null) ? cap : 'round';\n\t\tthis._strokeJoin = (join != null) ? join : 'round';\n\t\tthis._strokeDash = dash;\n\t\treturn this.invalidate();\n\t},\n\n\t// Rendering\n\n\telement_renderTo: Node.prototype.renderTo,\n\n\trenderTo: function(context, xx, yx, xy, yy, x, y){\n\t\tvar opacity = this._opacity;\n\t\tif (opacity == null || opacity >= 1){\n\t\t\treturn this.renderLayerTo(context, xx, yx, xy, yy, x, y);\n\t\t}\n\t\tif (this._fill && this._stroke){\n\t\t\treturn this.element_renderTo(context, xx, yx, xy, yy, x, y);\n\t\t}\n\t\tcontext.globalAlpha = opacity;\n\t\tvar r = this.renderLayerTo(context, xx, yx, xy, yy, x, y);\n\t\tcontext.globalAlpha = 1;\n\t\treturn r;\n\t},\n\n\trenderLayerTo: function(context, xx, yx, xy, yy, x, y){\n\t\tcontext.setTransform(xx, yx, xy, yy, x, y);\n\t\tthis.renderShapeTo(context);\n\t}\n\n});\n\nBase._genericContext = genericContext;\n\nmodule.exports = Base;\n"]},"metadata":{},"sourceType":"script"}